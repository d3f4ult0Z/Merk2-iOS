//
//  HomeProductsViewController.swift
//  Merk2
//
//  Created Adrian Jacobo on 07/10/21.
//  Copyright © 2021 ___ORGANIZATIONNAME___. All rights reserved.
//
//  Template generated by Juanpe Catalán @JuanpeCMiOS
//

import UIKit

class HomeProductsViewController: UIViewController {
    @IBOutlet weak var tableproducts: UITableView!
    
	var presenter: HomeProductsPresenterProtocol?
    var stores:[StoreData] = []

	override func viewDidLoad() {
        super.viewDidLoad()
        self.navigationController?.navigationBar.isHidden = true
        tableproducts.delegate = self
        tableproducts.dataSource = self
        tableproducts.register(UINib(nibName: "products", bundle: nil), forCellReuseIdentifier: "products")
        tableproducts.reloadData()
        presenter?.DataProducts()
    }
    
    override func viewDidAppear(_ animated: Bool) {
        super.viewDidAppear(animated)
//        NotificationCenter.default.post(name: NSNotification.Name("COUNTCART"), object: nil)
    }
}

extension HomeProductsViewController:HomeProductsViewProtocol{
    func StoreProducts(arreglo: [StoreData]) {
        stores = arreglo
        tableproducts.reloadData()
    }
    
    func StoreProductserror(message: String) {
        let alert = UIAlertController(title: "No hay información", message: "Error", preferredStyle: .alert)
        alert.addAction(UIAlertAction(title:"Continua", style: .default, handler: nil))
        self.present(alert, animated: true, completion: nil)
    }
}

extension HomeProductsViewController: UITableViewDelegate, UITableViewDataSource{
    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {
        return stores.count
    }
    
    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {
        if let products = tableView.dequeueReusableCell(withIdentifier: "products") as? products{
            products.title.text = stores[indexPath.row].nombre
            products.content.text = stores[indexPath.row].descripcion
            products.price.text = stores[indexPath.row].horario
            if let urlImg = URL(string: stores[indexPath.row].imagen){
                products.imaproducts.af.setImage(withURL: urlImg)
            }
            return products
        }
        return UITableViewCell()
    }
    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {
        self.presenter?.navigateDetailStore(data: self.stores[indexPath.row])
    }
}


